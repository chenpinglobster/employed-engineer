{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "DOM Assertions",
  "description": "DOM-first UI verification results",
  "type": "object",
  "required": ["version", "timestamp", "url", "assertions", "summary"],
  "properties": {
    "version": {
      "type": "string",
      "const": "1.0"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time"
    },
    "url": {
      "type": "string",
      "description": "Page URL being tested"
    },
    "viewport": {
      "type": "object",
      "properties": {
        "width": { "type": "integer" },
        "height": { "type": "integer" }
      }
    },
    "assertions": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "type", "selector", "pass"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique assertion identifier"
          },
          "type": {
            "type": "string",
            "enum": ["exists", "text", "attribute", "state", "count", "visible", "enabled"]
          },
          "selector": {
            "type": "string",
            "description": "CSS selector or aria role"
          },
          "expected": {
            "description": "Expected value (type depends on assertion type)"
          },
          "actual": {
            "description": "Actual value found"
          },
          "pass": {
            "type": "boolean"
          },
          "error": {
            "type": "string",
            "description": "Error message if assertion failed"
          },
          "screenshot_ref": {
            "type": "string",
            "description": "Reference to screenshot if visual verification needed"
          }
        }
      }
    },
    "summary": {
      "type": "object",
      "required": ["total", "passed", "failed"],
      "properties": {
        "total": { "type": "integer", "minimum": 0 },
        "passed": { "type": "integer", "minimum": 0 },
        "failed": { "type": "integer", "minimum": 0 },
        "skipped": { "type": "integer", "minimum": 0 }
      }
    },
    "dom_snapshot": {
      "type": "object",
      "description": "Partial DOM snapshot for failed assertions",
      "properties": {
        "file": {
          "type": "string",
          "description": "Path to dom_snapshot.html"
        },
        "selectors_captured": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "visual_upgrade": {
      "type": "object",
      "description": "Present only if DOM verification was insufficient",
      "properties": {
        "reason": {
          "type": "string",
          "enum": ["canvas", "webgl", "chart", "extension", "multi-window", "animation"]
        },
        "screenshots": {
          "type": "array",
          "items": { "type": "string" }
        },
        "recording": {
          "type": "string",
          "description": "Path to screenrecord.mp4"
        },
        "steps_file": {
          "type": "string",
          "description": "Path to steps.md with step descriptions"
        }
      }
    }
  }
}
